Comment Open Food Facts utilise les logos pour obtenir des informations produits

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üßÇUne pinc√©e de contexte :</strong> ‚Äúlogos‚Äù ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts contient environ <strong>3 millions de produits</strong>. Chaque produit est enrob√© dans un emballage con√ßu pour √™tre aussi attractif que possible. √Ä cette fin, les producteurs mettent en valeur les qualit√©s de leurs produits avec des <strong>symboles criards et explicites</strong>. Il existe de nombreux symboles diff√©rents fournissant des informations sur la marque, la qualit√©, la composition, les conditions de fabrication, ses consignes de recyclage, etc‚Ä¶&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Pour homog√©n√©iser les symboles et aider les consommateurs √† trouver les produits qui leur conviennent, <strong>plusieurs institutions ont √©dit√© des r√®gles strictes contraignant les producteurs √† signaler leurs produits avec des symboles sp√©cifiques, les "logos"</strong>. C'est une formidable opportunit√© üî• de r√©colter des donn√©es en d√©tectant ces logos !</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Comment devraient-ils √™tre reconnus par Open Food Facts ? Par un m√©lange de technologie et de contributions humaines, comme toujours !</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Rapha√´l Bournhonesque, ancien b√©n√©vole Open Food Facts d√©sormais membre de l'√©quipe permanente qui m'a supervis√© en stage, avait d√©velopp√© sur Robotoff* <strong>un syst√®me pour extraire les logos d'une image donn√©e, les convertir en images vectorielles et trouver leurs cousins les plus proches.</strong> Le but √©tait de <strong>permettre √† nos contributeurs d'annoter (cat√©goriser manuellement) d'√©normes quantit√©s de logos en m√™me temps √† travers la plateforme <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>üòâ.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Toutefois, les mod√®les et algorithmes utilis√©s ne fournissaient pas de r√©sultats suffisamment efficaces.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>En septembre 2022, je menais des √©tudes d'ing√©nierie. J'ai rejoint l'√©quipe pour un stage de 6 mois d√©di√©s aux logos, et j'ai travaill√© √† r√©impl√©menter tout ce processus ! ü•≥&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* Qu'est-ce que Robotoff ?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> est un service d√©velopp√© par nos contributeurs pour aider √† traiter les donn√©es d'Open Food Facts. D'apr√®s les donn√©es d√©j√† disponibles dans la base de donn√©es, l'objectif est de r√©cup√©rer autant d'informations que possible sur chaque produits et de les ajouter √† la base de donn√©es. Actuellement, les mises √† jour Robotoff s'appuient sur l'analyse d'images √† travers la reconnaissance optique de caract√®res ou d'autres mod√®les de vision par ordinateur plus g√©n√©raux. Certaines mises √† jour sont appliqu√©es automatiquement, d'autres doivent √™tre valid√©es manuellement.<br><br><em><strong>Pour en savoir plus sur Robotoff, regardez <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">ici</a>!</strong></em> üëÄ</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>ü´ó Un filet de technologie : </strong>Comment fonctionne le traitement des logos ?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1Ô∏è‚É£ </em>Extraire les logos d'images produits :</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Les contributeurs Open Food Facts ont entra√Æn√© un mod√®le de machine learning √† reconna√Ætre les logos dans les images. Nous renseignons une image en entr√©e du mod√®le et l'algorithme s√©pare les diff√©rents logos en cadres d√©limit√©s avec des scores et classes associ√©s. Le mod√®le a √©t√© entra√Æn√© sur les classes "marque" et "label".</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vous pouvez trouver le code ici : <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vous pouvez l'essayer √† travers l'API suivante :&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vous pouvez distinguer les diff√©rents logos en cadres d√©limit√©s avec l'API :<a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> o√π les coordonn√©es sont dans le m√™me ordre que celles renvoy√©es par le mod√®le dans les cadres d√©limit√©s.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Voil√†, par exemple, ce qu'il se passe en utilisant ces APIs avec l'image suivante :</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2Ô∏è‚É£ </em>Convertir les images de logos en images vectorielles :</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Maintenant que nous pouvons acc√©der aux logos, il faut les vectoriser</strong>. Pour cela, nous utilisons un mod√®le OpenAI pr√©-entra√Æn√© appel√© <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Bien que le mod√®le ait √©t√© initialement entra√Æn√© pour faire correspondre des images avec du texte, nous n'utilisons que la fonctionnalit√© "vision par ordinateur" du mod√®le pour r√©cup√©rer les int√©grations (les logos transf√©r√©s dans un espace vectoriel) calcul√©s par CLIP pour chaque logo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Nous avons donc une image de logo en entr√©e et une image vectorielle de dimension 512 en sortie. Plus courte est la distance entre deux vecteurs, plus les deux logos correspondants sont similaires.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>La fonction <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> dans Robotoff est charg√©e d'appliquer le mod√®le aux logos et de sauvegarder les int√©grations dans la base de donn√©es postgresql de Robotoff.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vous pouvez trouver des exemples de code plus explicites <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">ici</a> pour comprendre comment CLIP g√©n√®re des int√©grations de logos.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3Ô∏è‚É£ </em>Trouver les voisins les plus proches :</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Pour trouver les proches voisins d'un logo, nous utilisons un "index" pour stocker les int√©grations. Une fois que l'index est √©tabli, nous pouvons utiliser la <strong>"force brute"üí™ qui consiste √† calculer la distance entre le logo renseign√© et tous les autres logos de la base de donn√©es pour r√©cup√©rer les voisins les plus proches</strong>. C'est la m√©thode la plus pr√©cise, renvoyant les "vrais" voisins proches. Toutefois, cette m√©thode est trop lente pour √™tre utilis√©e. Avec 2,5 millions de logos, il faut environ trois secondes pour extraire les voisins de chaque logo üò¥</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puisque nous souhaitions acc√©l√©rer la recherche et que nous acceptions de r√©duire la pr√©cision, nous avons d√©cid√© d'utiliser <strong>une m√©thode approximative</strong>. Celui qu'utilise Robotoff s'appelle HNSW (hierarchical navigable small world). Vous pouvez consulter <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">cet article</a> pour mieux comprendre la recherche par voisins.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Gr√¢ce √† un index ElasticSearch HNSW, Robotoff peut maintenant rechercher les proches voisins de chaque int√©gration parmi plus de 2.5 millions de vecteurs avec une grande pr√©cision (plus de 90% des 100 voisins renvoy√©s sont parmi les 100 plus proches voisins) et un court temps de recherche de moins de 100ms üëèüëèüëèüëè.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vous pouvez utiliser l'API suivante pour obtenir les plus proches voisins d'un logo¬†: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üçØ Une cuill√®re de contributions : </strong>O√π est-ce utilis√© ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Pour l'instant, Robotoff n'impl√©mente pas encore la cat√©gorisation automatique par logos. Tous les exemples pr√©c√©dents sont uniquement appliqu√©s √† <a href="https://hunger.openfoodfacts.org/">Hunger Games</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Qu'est-ce donc ? C'est une <strong>plateforme d'annotations </strong>d√©velopp√©e par un contributeur, Alexandre Fauquette, qui <strong>permet √† tout le monde de v√©rifier les pr√©dictions de Robotoff et cat√©goriser les logos</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Vous pouvez l'essayer. Apr√®s un rapide tutoriel, vous pourrez annoter des logos ! üòâ<br>Un tutoriel vid√©o devrait bient√¥t para√Ætre‚Ä¶ ‚è≥</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Pour utiliser Hunger Games : hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Annoter les logos am√©liore Open Food Facts en compl√©tant nos donn√©es sur les produits et leur qualit√©.</strong> Et gr√¢ce aux mod√®les et algorithmes utilis√©s en fond, vous pouvez impacter l'alimentation quotidienne des utilisateurs plus fortement que jamais ü•∞.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Article par Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
