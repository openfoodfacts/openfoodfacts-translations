C√≥mo Open Food Facts utiliza logotipos para obtener informaci√≥n sobre productos alimenticios

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üßÇUna pizca de contexto:</strong> ‚Äúlogos‚Äù ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts contiene aproximadamente <strong>3 millones de productos</strong>. Cada producto tiene un embalaje que est√° hecho para atraer al mayor n√∫mero de personas posible. To this regard, productors highlight the qualities of their products with<strong> flashy and explicit symbols</strong>. Estos s√≠mbolos son numerosos y pueden dar informaci√≥n sobre la marca del producto, su calidad, su composici√≥n, la forma de elaboraci√≥n, en qu√© grano desecharlo, etc.‚Ä¶&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Para homogeneizar todos los s√≠mbolos y ayudar a los consumidores a encontrar productos que se ajusten a ellos, <strong>diversas instituciones han creado reglas estrictas para que los productores puedan marcar sus productos con s√≠mbolos espec√≠ficos que llamamos ‚Äúlogotipos‚Äù</strong>. ¬°Existe entonces una gran oportunidad üî• de obtener datos sobre los productos detectando estos logotipos!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>How should Open Food Facts detect them ? Thanks to a mix between technology and contributors, as always! ¬°Gracias a una mezcla entre tecnolog√≠a y colaboradores, como siempre!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Rapha√´l Bournhonesque, un antiguo colaborador de Open Food Facts que ahora forma parte del equipo permanente y es mi supervisor de pr√°cticas, desarroll√≥ en Robotoff* <strong>un sistema para extraer logotipos de im√°genes, convertirlos en vectores y encontrar los vecinos m√°s cercanos de cada vector.</strong> El objetivo de encontrar los vecinos de los logotipos era <strong>permitir a los colaboradores "anotar" (categorizar manualmente) cantidades masivas de logotipos al mismo tiempo a trav√©s de una plataforma llamada <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Los Juegos del Hambre</a> </strong>üòâ.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Sin embargo, los modelos y algoritmos utilizados en aquel entonces no pod√≠an dar resultados suficientemente eficientes.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In September 2022, I, an engineering student, joined the team for an internship of 6 months which would be dedicated to logos, and I worked on refactoring this whole process! ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp; ü•≥&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* ¬øQu√© es Robotoff?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> es un servicio desarrollado por colaboradores para facilitar el procesamiento de datos de Open Food Facts. A partir de los datos ya disponibles en la base de datos, el objetivo es recuperar la mayor cantidad de informaci√≥n posible sobre cada producto y agregarlos a la base de datos. Actualmente, las actualizaciones que realiza Robotoff provienen del an√°lisis de im√°genes, pasando por Reconocimiento √ìptico de Caracteres o modelos m√°s generales de Visi√≥n por Computador. Algunas actualizaciones se aplican autom√°ticamente a la base de datos, pero otras necesitan validaci√≥n manual mediante preguntas o Los Juegos del Hambre.<br><br><em><strong>Para saber m√°s sobre Robotoff, echa un vistazo <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">aqu√≠</a>!</strong></em>üëÄ</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>ü´ó Un poco de tecnolog√≠a: </strong>¬øC√≥mo funciona exactamente el procesamiento de logotipos?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1Ô∏è‚É£ </em>Extraer logotipos de im√°genes de productos:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Los colaboradores de Open Food Facts entrenaron un modelo de aprendizaje autom√°tico para reconocer logotipos en im√°genes. Colocamos una imagen como entrada del modelo y recibimos m√∫ltiples cuadros delimitadores con puntuaciones y clases correspondientes. Las clases en las que se entren√≥ el modelo fueron ‚Äúmarca‚Äù y ‚Äúetiqueta‚Äù.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puedes encontrar el c√≥digo donde se llama al modelo aqu√≠: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puedes probarlo usando la siguiente API:&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Con los cuadros delimitadores, puedes ver cu√°les son los logotipos correspondientes con la API: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> donde las coordenadas est√°n en el mismo orden que las devueltas por el modelo en los cuadros delimitadores.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A continuaci√≥n se muestra un ejemplo de lo que sucede al utilizar estas API con la siguiente imagen:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2Ô∏è‚É£ </em>Convertir im√°genes de logotipos a vectores:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Ahora que podemos acceder a los logotipos, necesitamos vectorizarlos</strong>. Para ello, utilizamos un modelo preentrenado de OpenAI llamado <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Aunque el modelo fue entrenado inicialmente para hacer coincidir im√°genes con texto, usamos solo la parte de ‚Äúvisi√≥n por computadora‚Äù del modelo para obtener las incrustaciones (=logotipos incrustados en un espacio vectorial) calculadas por CLIP para cada logotipo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>De esta forma tenemos como entrada una imagen de logotipo y como salida un vector de dimensi√≥n 512. Cuanto menor sea la distancia entre dos vectores, m√°s similares ser√°n los dos logotipos correspondientes.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>La funci√≥n <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> en Robotoff se encarga de aplicar el modelo a los logotipos y guardar las incrustaciones en la base de datos postgresql de Robotoff.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puedes encontrar un c√≥digo m√°s expl√≠cito <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">aqu√≠</a> para entender c√≥mo usamos CLIP para generar incrustaciones de logotipos.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3Ô∏è‚É£ </em>Encuentra vecinos m√°s cercanos:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Para encontrar los vecinos m√°s cercanos de un logotipo, utilizamos un ‚Äú√≠ndice‚Äù para almacenar las incrustaciones. Una vez construido este √≠ndice, podr√≠amos utilizar el m√©todo de ‚Äúfuerza bruta‚Äù <strong>üí™ que consiste en calcular la distancia entre el logo de la consulta y todos los dem√°s logos de la BD y devolver los m√°s cercanos</strong>. √âste es el m√©todo m√°s preciso ya que nos da los vecinos m√°s cercanos ‚Äúverdaderos‚Äù. Sin embargo, este m√©todo es demasiado lento para ser aplicado. El tiempo necesario para extraer los vecinos m√°s cercanos para cada logotipo cuando la cantidad total de logotipos es de 2,5 millones es de alrededor de 3 s üò¥</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Como necesit√°bamos un mejor tiempo de b√∫squeda y nos conform√°bamos con tener menos precisi√≥n, decidimos utilizar <strong>un m√©todo aproximado</strong>. El que utiliza Robotoff se llama HNSW (mundo peque√±o navegable jer√°rquico). Puedes echar un vistazo a <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">este art√≠culo</a> para comprender mejor la b√∫squeda de vecinos m√°s cercanos.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Al utilizar un √≠ndice ElasticSearch de HNSW, Robotoff ahora puede buscar los vecinos m√°s cercanos de cada incrustaci√≥n entre m√°s de 2,5 millones de vectores con una enorme precisi√≥n (m√°s del 90 % de los 100 vecinos m√°s cercanos devueltos se encuentran entre los 100 vecinos m√°s cercanos reales exactos) y un tiempo de b√∫squeda corto de menos de 100 ms üëèüëèüëèüëè.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Puede utilizar la siguiente API para obtener los vecinos m√°s cercanos de un logotipo: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üçØ Una cucharada de aportes: </strong>¬øD√≥nde se utiliza?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Todav√≠a no se ha implementado ninguna categorizaci√≥n autom√°tica de logotipos en Robotoff. Todo lo que expliqu√© antes est√° hecho solo para <a href="https://hunger.openfoodfacts.org/">Los Juegos del Hambre</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>¬øQu√© es? What is it ? What is it ? What is it ? What is it ? What is it ? What is it ? What is it ? It is <strong>an annotation platform </strong>developed by a contributor named Alexandre Fauquette which <strong>allows everyone to answer check predictions made by Robotoff and to categorise logos</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Puedes probarlo ¬°Una breve introducci√≥n/tutorial te dar√° la bienvenida y podr√°s anotar logotipos! A quick introduction/tutorial will welcome you and you will be able to annotate logos ! üòâ<br>A video tutorial of ‚ÄúHow to use Hunger Games ?‚Äù should be out soon‚Ä¶ ‚è≥</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Para jugar a los Juegos del Hambre: hungry.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Anotar logotipos mejora Open Food Facts a medida que aumenta la cantidad de datos que tenemos sobre los productos y su calidad.</strong> Y gracias a los modelos y algoritmos utilizados en segundo plano, puedes ser mucho m√°s poderoso y tener un mayor impacto en la alimentaci√≥n diaria de las personas ü•∞.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Art√≠culo de Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
