Hoe Open Food Facts logo's gebruikt om informatie over voedingsmiddelen te krijgen

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🧂Een snufje context:</strong> "logo's" ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts is gevuld met ongeveer <strong>3 miljoen producten</strong>. Elk product heeft een verpakking die gemaakt is om zoveel mogelijk mensen aan te trekken. Hiertoe benadrukken producenten de kwaliteiten van hun producten met<strong> flitsende en expliciete symbolen</strong>. Deze symbolen zijn talrijk en kunnen informatie geven over het merk van het product, de kwaliteit, de samenstelling, de manier waarop het is gemaakt, in welke bak het moet worden weggegooid, enz.…&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Om alle symbolen te homogeniseren en consumenten te helpen producten te vinden die bij hen passen, hebben <strong>verschillende instellingen strikte regels opgesteld zodat producenten hun producten kunnen markeren met specifieke symbolen die we “logo’s”</strong>noemen. Er is dus een enorme kans 🔥 om gegevens over producten te krijgen door deze logo's te detecteren!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Hoe moet Open Food Facts ze detecteren? Dankzij een mix tussen technologie en bijdragers, zoals altijd!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Raphaël Bournhonesque, voormalig bijdrager aan Open Food Facts, nu onderdeel van het vaste team en mijn stagebegeleider, had in Robotoff* <strong>een systeem ontwikkeld om logo's uit afbeeldingen te extraheren, deze in vectoren om te zetten en de dichtstbijzijnde buren van elke vector te vinden.</strong> Het doel van het vinden van de buren van logo's was <strong>om bijdragers in staat te stellen enorme hoeveelheden logo's tegelijkertijd te 'annoteren' (handmatig te categoriseren) via een platform met de naam <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>😉.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>De toen gebruikte modellen en algoritmen konden echter niet efficiënt genoeg resultaten opleveren.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In september 2022 kwam ik, een ingenieursstudent, bij het team voor een stage van 6 maanden die gewijd zou zijn aan logo's, en ik werkte aan het refactoren van dit hele proces! 🥳&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* Wat is Robotoff?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> is een service die is ontwikkeld door bijdragers om de gegevensverwerking van Open Food Facts te ondersteunen. Op basis van de gegevens die al in de database aanwezig zijn, is het doel om over elk product zoveel mogelijk informatie op te halen en toe te voegen aan de database. Momenteel zijn de updates van Robotoff afkomstig van beeldanalyse, via optische karakterherkenning of meer algemene "Computer Vision modellen". Sommige updates worden automatisch op de database toegepast, maar andere hebben handmatige validatie nodig via vragen of Hunger Games.<br><br><em><strong>Kijk <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">hier</a>voor meer informatie over Robotoff!</strong></em>👀</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>🫗 Een vleugje technologie: </strong>Hoe werkt de verwerking van logo's precies?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1️⃣ </em>Haal logo's uit productafbeeldingen:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Bijdragers van Open Food Facts hebben een "Machine Learning model" getraind om logo's in afbeeldingen te herkennen. We plaatsen een afbeelding als invoer in het model en we ontvangen meerdere selectiekaders met bijbehorende scores en klassen. De klassen waarop het model werd getraind waren ‘merk’ en ‘label’.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Je kunt de code waarin het model wordt aangeroepen hier vinden: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Je kunt het proberen door de volgende API te gebruiken:&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models= universele logodetector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Met de selectiekaders kunt u zien wat de bijbehorende logo's zijn via de API: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> waarbij de coördinaten in dezelfde volgorde staan als die door het model in de selectiekaders worden geretourneerd.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Hier is een voorbeeld van wat er gebeurt bij het gebruik van deze API's met de volgende afbeelding:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2️⃣ </em>Converteer afbeeldingen van logo's naar vectoren:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Nu we toegang hebben tot logo's, moeten we ze vectoriseren</strong>. Daarvoor gebruiken we een vooraf getraind model van OpenAI genaamd <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Ook al was het model aanvankelijk getraind om afbeeldingen met tekst te matchen, gebruiken we alleen het “computer vision”-gedeelte van het model om de insluiting (=logo's ingesloten in een vectorruimte) te krijgen die door CLIP voor elk logo zijn berekend.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We hebben dus een logo-afbeelding als invoer en een vector met dimensie 512 als uitvoer. Hoe kleiner de afstand tussen twee vectoren, hoe meer de twee overeenkomstige logo's op elkaar lijken.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>De functie <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> in Robotoff is verantwoordelijk voor het toepassen van het model op de logo's en het opslaan van insluitingen in de postgresql-database van Robotoff.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Je kunt <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">hier</a> een meer expliciete code vinden om te begrijpen hoe we CLIP gebruiken om logo-insluitingen te genereren.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3️⃣ </em>Vind naaste buren:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Om de dichtstbijzijnde buren van een logo te vinden, gebruiken we een “index” om de insluitingen op te slaan. Zodra deze index is gebouwd, kunnen we de <strong>“brute force” 💪-methode gebruiken, die bestaat uit het berekenen van de afstand tussen het "querylogo" en alle andere logo's van de database en de dichtstbijzijnde retourneren.</strong>. Dat is de meest precieze methode omdat het ons de "echte" naaste buren geeft. Deze methode is echter te traag om toe te passen. De tijd die nodig is om de dichtstbijzijnde buren voor elk logo te extraheren wanneer het totale aantal logo's 2,5 miljoen is, is ongeveer 3 seconden 😴</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Omdat we een betere zoektijd nodig hadden en het oké vonden om minder nauwkeurig te zijn, hebben we besloten om <strong>een geschatte methode</strong> te gebruiken. Degene die Robotoff gebruikt heet "HNSW" (hierarchical navigable small world). Je kunt <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">dit artikel</a> bekijken voor een beter inzicht in het zoeken naar dichtstbijzijnde buren.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Met behulp van een "HNSW ElasticSearch-index" kan Robotoff nu met een enorme precisie zoeken naar de dichtstbijzijnde buren van elke insluiting tussen meer dan 2,5 miljoen vectoren (meer dan 90% van de 100 geretourneerde dichtstbijzijnde buren behoren tot de exact 100 echte dichtstbijzijnde buren) en een korte zoektijd van minder dan 100 ms 👏👏👏👏.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Je kunt de volgende API gebruiken om de dichtstbijzijnde buren van een logo te krijgen: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🍯 Een lepel bijdragen: </strong>Waar wordt het gebruikt?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Er is nog geen automatische logo-categorisatie geïmplementeerd in Robotoff. Alles wat ik eerder heb uitgelegd, is alleen gemaakt voor <a href="https://hunger.openfoodfacts.org/">Hunger Games</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Wat is het? Het is <strong>een annotatieplatform </strong>ontwikkeld door een bijdrager met de naam "Alexandre Fauquette" die <strong>iedereen in staat stelt de voorspellingen van Robotoff te beantwoorden en logo's</strong> te categoriseren.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Je kunt het proberen. Een korte introductie/tutorial zal u welkom heten en u zult in staat zijn om logo's te annoteren! 😉<br>Een video-tutorial over "Hoe gebruik je Hunger Games?" zou binnenkort moeten verschijnen… ⏳</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Om de Hunger Games te spelen: hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Het annoteren van logo's verbetert Open Food Facts naarmate de hoeveelheid productgegevens die we hebben en de kwaliteit ervan groeit.</strong> En dankzij de modellen en algoritmen die op de achtergrond worden gebruikt, kun je een veel grotere impact hebben op de dagelijkse voeding van mensen 🥰.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Artikel door Gabriël</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
