Open Food Facts 如何利用标识获取食品信息

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🧂A pinch of context:</strong> “logos” ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts 目前大概有大约 <strong>300 万产品</strong>。 每种产品都有一个包装，旨在吸引尽可能多的人。 在这方面，生产者用<strong> 闪亮和明确符号</strong> 突出了他们产品的质量。 这些符号种类繁多，可以提供有关产品品牌、质量、成分、制造方式、丢弃方式等信息。…&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>为了使所有符号同质化并帮助消费者找到适合他们的产品， <strong>各个机构都制定了严格的规则，要求生产商能够用特定的符号标记他们的产品，我们称之为“标识”</strong>。 因此，通过检测这些标识来获取有关产品的数据是一个巨大的机会🔥！</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>How should Open Food Facts detect them ? Thanks to a mix between technology and contributors, as always!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Raphaël Bournhonesque 曾是 Open Food Facts 的贡献者，现在是常驻团队成员和我的实习主管，他在 Robotoff* <strong>中开发了一个系统，用于从图像中提取标志，将其转换为矢量，并找到每个矢量的最近邻数据。让贡献者通过一个名为 <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">饥饿游戏</a> 😉 的平台打标大量标志和标签信息。</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>然而，当时使用的模型和算法无法给出足够有效的结果。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2022 年 9 月，我作为一名工程专业的学生加入了团队，进行了为期 6 个月的实习，专注于这个打标问题，并致力于重构整个流程！ 🥳&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* 什么是 Robotoff？</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> 是由贡献者开发的一项服务，旨在帮助 Open Food Facts 进行数据的流程化处理。 根据数据库中已有的数据，目标是检索有关每种产品的尽可能多的信息并将其添加到数据库中。 目前，Robotoff 所做的更新来自图像分析，通过光学字符识别或更通用的计算机视觉模型。 一些更新会自动应用到数据库，但另一些更新需要通过问题或饥饿游戏进行手动验证。<br><br><em><strong>要了解有关 Robotoff 的更多信息，请查看 <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">这里</a>!</strong></em>👀</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>🫗 一点技术： </strong>标志处理究竟是如何工作的？</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1️⃣ </em>从产品图片中提取标志：</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts 的贡献者训练了一个机器学习模型来识别图像中的标志。 我们将图像作为模型的输入，并收到具有相应分数和类别的多个边界框。（目标标记） 该模型训练的类别是“品牌”和“标签”。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>您可以在此处找到调用该模型的代码： <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>您可以使用以下 API 尝试：&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>通过边界框，您可以看到 API 对应的标志： <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> 其中坐标的顺序与模型在边界框中返回的坐标顺序相同。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下是使用这些 API 时发生的情况的示例，其中包含以下图像：</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2️⃣ </em>将标志图像转换为矢量图：</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>现在我们可以访问标志，我们需要将它们矢量化</strong>。 为此，我们使用了 OpenAI 的预训练模型，名为 <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>。 <strong>Now that we can access logos, we need to vectorise them</strong>. For that, we use a pre-trained model from OpenAI called <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Even though the model was initially trained to match images with text, we use only the “computer vision” part of the model to get the embeddings (=logos embedded in a vector space) computed by CLIP for each logo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>因此，我们有一个标志图像作为输入，一个维度为 512 的向量作为输出。 两个向量之间的距离越小，对应的两个标志越相似。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Robotoff 中的 <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> 函数负责将模型应用于标志并将嵌入保存到 Robotoff postgresql 数据库。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>您可以在这里<a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener"> 查阅代码 </a>以了解我们如何使用 CLIP 生成标志嵌入。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3️⃣ </em>寻找最近邻：</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>为了找到标志的最近邻匹配项，我们使用“索引”来存储嵌入。 一旦建立了这个索引，我们就可以使用 <strong>“蛮力”💪方法，该方法包括计算查询标志与数据库中所有其他标志之间的距离，并返回最接近的标志</strong>。 这是最精确的方法，因为它为我们提供了“真正的”最近邻结果。 但这种方法在应用中执行过于缓慢。 当标志总数为 250 万个时，提取每个标志的最近邻操作所需的时间约为 3 秒😴</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>由于我们需要更好的搜索时间并且可以接受较低的精度，我们决定使用 <strong>一种近似方法</strong>。 The one that Robotoff uses is called HNSW (hierarchical navigable small world). 您可以查看 <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">这篇文章</a> 以更好地了解最近邻搜索。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>使用 HNSW ElasticSearch 索引，Robotoff 现在能够在超过 2.5M 个向量中查找每个嵌入的最近邻居，并且具有极高的精度（返回的 100 个最近邻居中超过 90% 都在恰好 100 个真正的最近邻之中），并且搜索时间少于 100 毫秒👏👏👏👏。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>您可以使用以下 API 来获取标志的最近邻： <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🍯 A spoon of contributions: </strong>Where is it used?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Robotoff 尚未实现自动标志分类。 我之前解释的一切仅适用于 <a href="https://hunger.openfoodfacts.org/">饥饿游戏</a>。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>What is it ? 它是 <strong>一个注释平台 </strong>，由一位名叫 Alexandre Fauquette 的贡献者开发，它 <strong>允许每个人回答 Robotoff 做出的检查预测并对标志进行分类</strong>。&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>你可以尝试一下。 快速介绍/教程将欢迎您，您将能够注释标志！ 😉<br>“如何使用饥饿游戏？”的视频教程应该很快就会发布… ⏳</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">玩饥饿游戏：hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>注释标志增强了 Open Food Facts，因为它增加了我们拥有的产品及其质量的数据量。</strong> 并且由于后台使用的模型和算法，您可以变得更加强大，并对人们的日常饮食产生更大的影响🥰。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>作者：Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
