Hvordan Open Food Facts bruger logoer til at fÃ¥ information om fÃ¸devareprodukter

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ§‚Et drys kontekst:</strong> "Logoer"?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts indeholder omkring <strong>3 millioner produkter</strong>. Hver produktemballage er designet mhp. at tiltrÃ¦kke flest mulige kunder. Til det formÃ¥l fremhÃ¦ver producenterne produkternes kvaliteter med<strong> prangende og letgenkendelige symboler</strong>. Disse symboler er talrige, typisk med oplysninger om produktbrand, kvalitet, sammensÃ¦tning, fremstillingsmÃ¥de, affaldstype mv.â€¦&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>For at homogenisere alle symboler og hjÃ¦lpe forbrugerne til at finde relevante produkter, <strong>har forskellige institutioner lavet strenge regler, sÃ¥ producenter kan mÃ¦rke deres produkter med bestemte symboler refereret til som "logoer"</strong>. Der er sÃ¥ledes en kÃ¦mpe mulighed ğŸ”¥ for at fÃ¥ produktdata ved at detektere disse logoer!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Hvordan skal Open Food Facts detektere dem? Gennem et miks af teknologi og bidragsydere, som altid!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>RaphaÃ«l Bournhonesque, en tidligere Open Food Facts-bidragsyder, der nu er en del af det faste team og min praktikvejleder, havde i Robotoff* <strong>udviklet et system til at udtrÃ¦kke logoer fra fotos, konvertere dem til vektorer og finde de nÃ¦rmeste naboer til hver vektor.</strong> MÃ¥let med at finde logoers naboer var <strong>at give bidragsydere mulighed for at "annotere" (manuelt kategorisere) enorme mÃ¦ngder af logoer pÃ¥ samme tid gennem en platform kaldet <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>ğŸ˜‰.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>De dengang anvendte modeller og algoritmer kunne dog ikke levere tilstrÃ¦kkeligt effektive resultater.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>I september 2022 tilsluttede jeg, en ingeniÃ¸rstuderende, mig holdet i et 6 mÃ¥neders praktikophold, der skulle vÃ¦re dedikeret til logoer, og jeg arbejdede pÃ¥ at omstrukturere hele denne proces! ğŸ¥³&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* Hvad er Robotoff?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> er en bidragsyderudviklet tjeneste til at hjÃ¦lpe med Open Food Facts-databehandling. Baseret pÃ¥ de allerede tilgÃ¦ngelige data i databasen, er mÃ¥let at hente sÃ¥ mange informationer som muligt om hvert produkt og fÃ¸je dem til db'en. Pt. kommer opdateringerne lavet af Robotoff fra billedanalyse, gennem Optical Character Recognition eller mere generelle Computer Vision-modeller. Nogle opdateringer anvendes automatisk i db'en, mens andre krÃ¦ver manuel validering via spÃ¸rgsmÃ¥l eller Hunger Games.<br><br><em><strong>For at vide mere om Robotoff, tag et kig <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">hÃ©r</a>!</strong></em>ğŸ‘€</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ«— En regn af teknologi: </strong>PrÃ¦cist hvordan fungerer logobehandling?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1ï¸âƒ£ </em>UdtrÃ¦k logoer fra produktfotos:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts-bidragsydere trÃ¦nede en Machine Learning-model til at genkende logoer pÃ¥ fotos. Et foto bruges som input til modellen, og der modtages flere afgrÃ¦nsningsbokse med korresponderede scorer og klasser. Klasserne, modellen blev trÃ¦net med, var "brand" og "etiket".</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Koden til modelkaldet findes her: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Det kan aftestes ved brug af flg. API:&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Med afgrÃ¦nsningsfelterne kan man med API'en se, hvilke som er de korresponderende logoer: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a>, hvor koordinaterne er i samme rÃ¦kkefÃ¸lge som dem, modellen returnerer i afgrÃ¦nsningsboksene.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Her er et eks. pÃ¥, hvad der sker, nÃ¥r disse API'er bruges med flg. foto:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2ï¸âƒ£ </em>KonvertÃ©r logofotos til vektorer:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Nu, hvor logoerne kan tilgÃ¥s, skal de vektoriseres</strong>. Til det bruges en prÃ¦trÃ¦net model fra OpenAI kaldet <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Selvom modellen oprindeligt blev trÃ¦net til at matche billeder med tekst, bruges kun "computervision"-delen af modellen til at fÃ¥ indlejringsdata (=logoer indlejret i et vektorrum) beregnet af CLIP for hvert logo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Der har sÃ¥ledes et logobillede som input og en vektor med dimension 512 som output. Jo kortere afstand mellem to vektorer, jo mere ens er de to tilsvarende logoer.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Funktionen <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> i Robotoff styrer anvendelsen af modellen pÃ¥ logoer og gemmer indlejringer til Robotoff postgresql-databasen.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>En mere eksplicit kode kan findes <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">hÃ©r</a> for at forstÃ¥, hvordan CLIP bruges til at generere logo-indlejringer.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3ï¸âƒ£ </em>Find nÃ¦rmeste naboer:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>For at finde de nÃ¦rmeste naboer til et logo bruges et "indeks" til lagring af indlejringerne. NÃ¥r dette indeks er bygget, kunne der bruges <strong>"brute force"-metoden ğŸ’ª, der bestÃ¥r i at beregne afstanden mellem forespÃ¸rgselslogoet og alle Ã¸vrige logoer i db'en, og returnere de nÃ¦rmeste</strong>. Det er den mest prÃ¦cise metode, da den giver de "reelle" nÃ¦rmeste naboer. Denne metode er dog for langsom i praksis. Tiden til at udtrÃ¦kke de nÃ¦rmeste naboer for hvert logo, nÃ¥r det samlede logoantal er 2,5M, udgÃ¸r ca. 3s ğŸ˜´</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Da der var behov for en bedre sÃ¸getid og en lavere prÃ¦cision var OK, blev <strong>en omtrentlig metode</strong> valgt. Den, Robotoff bruger, kaldes HNSW (hierarchical navigable small world). Tag evt. et kig pÃ¥ <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">denne artikel</a> for bedre at forstÃ¥ nÃ¦rmeste nabosÃ¸gning.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Vha. et HNSW ElasticSearch-indeks er Robotoff nu i stand til at lede efter de nÃ¦rmeste naboer til hver indlejring blandt flere end 2,5 millioner vektorer med en enorm prÃ¦cision (flere end 90 % af de 100 nÃ¦rmeste naboer, som returneres, er blandt de nÃ¸jagtige 100 reelle nÃ¦rmeste naboer) og en kort sÃ¸getid pÃ¥ under 100ms ğŸ‘ğŸ‘ğŸ‘ğŸ‘.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Flg. API kan bruges til at fÃ¥ de nÃ¦rmeste naboer til et logo: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ¯ En ske af bidrag: </strong>Hvor bruges det?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Ingen automatisk logokategorisering er endnu implementeret i Robotoff. Alt det tidligere forklarede er kun implementeret i <a href="https://hunger.openfoodfacts.org/">Hunger Games</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Hvad er det? Det er <strong>en annotationsplatform </strong>udviklet af en bidragyder ved navn Alexandre Fauquette, der <strong>giver alle mulighed for at besvare tjekforudsigelser udfÃ¸rt af Robotoff samt kategorisere logoer</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Man kan selv prÃ¸ve det. En hurtig introduktion/guide byder velkommen, og man vil ogsÃ¥ kunne kommentere logoer! ğŸ˜‰<br>En videoguide til "Hvordan bruges Hunger Games?" skulle snart udeâ€¦ â³</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">For at spille Hunger Games: hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Annoterende logoer forbedrer Open Food Facts, da det Ã¸ger mÃ¦ngden af data om produkter og deres kvalitet.</strong> Takket vÃ¦re de modeller og algoritmer, som bruges i baggrunden, kan man vÃ¦re meget mere kraftfuld og have en stÃ¸rre indflydelse pÃ¥ personers daglige kost ğŸ¥°.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Artikel af Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
