Open Food Factsがロゴを使って食品に関する情報を入手する方法

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🧂コンテキストのひとかけら:</strong> 「ロゴ」?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts には、約 <strong>300 万点の製品</strong>が掲載されています。 各製品には、できるだけ多くの人々を惹きつけるように作られたパッケージがあります。 この点に関して、生産者は自社製品の品質を<strong> 派手で明示的なシンボル</strong>で強調します。 これらのシンボルは数多くあり、製品のブランド、品質、成分、製造方法、どの豆を廃棄するかなどの情報を提供します…&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>すべてのシンボルを統一し、消費者が自分に合った製品を見つけやすくするために、 <strong>さまざまな機関が、生産者が「ロゴ」</strong>と呼ばれる特定のシンボルで製品にマークを付けることができるように厳格な規則を作成しました。 したがって、これらのロゴを検出することで、製品に関するデータを取得する大きなチャンス 🔥 があります!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Open Food Facts はどうやってそれらを検出するのでしょうか? いつものように、テクノロジーと貢献者の組み合わせに感謝します。</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>元 Open Food Facts 寄稿者で現在は常勤チームの一員であり、私のインターンシップ指導者でもある Raphaël Bournhonesque は、Robotoff* <strong>で、画像からロゴを抽出してベクトルに変換し、各ベクトルの最近傍を検索するシステムを開発しました。 </strong> ロゴの近傍を検索する目標は、 <strong>寄稿者が、 <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>というプラットフォームを通じて、大量のロゴを同時に「注釈を付ける」(手動で分類する) ことができるようにすることでした 😉。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかし、当時使用されていたモデルとアルゴリズムでは、十分に効率的な結果が得られませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2022年9月、私は工学部の学生として、ロゴに特化した6か月間のインターンシップのためにチームに参加し、このプロセス全体のリファクタリングに取り組みました。 🥳&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* Robotoff とは何ですか?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> は、Open Food Facts のデータ処理を支援するために貢献者によって開発されたサービスです。 データベースにすでに存在するデータに基づいて、各製品に関するできるだけ多くの情報を取得し、それをデータベースに追加することが目標です。 現在、Robotoff による更新は、光学式文字認識またはより一般的なコンピューター ビジョン モデルを介した画像分析から行われます。 一部の更新は自動的にデータベースに適用されますが、その他の更新は質問やハンガーゲームによる手動検証が必要です。 <br><br><em><strong>Robotoff について詳しくは、 <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">こちら</a>をご覧ください。</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>🫗 技術的な話: </strong>ロゴ処理は具体的にはどのように動作するのでしょうか?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1️⃣ </em>製品画像からロゴを抽出します。</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts の貢献者は、画像内のロゴを認識する機械学習モデルをトレーニングしました。 モデルの入力として画像を入力すると、対応するスコアとクラスを持つ複数の境界ボックスが返されます。 モデルがトレーニングされたクラスは「ブランド」と「ラベル」でした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>モデルが呼び出されるコードは、 <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>にあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>次の API を使用して試すことができます:&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>境界ボックスを使用すると、API で対応するロゴを確認できます。 <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> ここで、座標は境界ボックスでモデルによって返される順序と同じです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>次の画像でこれらの API を使用した場合に何が起こるかの例を示します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2️⃣ </em>ロゴ画像をベクターに変換します。</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>ロゴにアクセスできるようになったので、ロゴをベクトル化する必要があります</strong>。 そのために、OpenAI の <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>という事前トレーニング済みのモデルを使用します。 モデルは当初、画像とテキストを一致させるようにトレーニングされていましたが、各ロゴに対して CLIP によって計算された埋め込み (ベクトル空間に埋め込まれたロゴ) を取得するために、モデルの「コンピューター ビジョン」部分のみを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>したがって、入力としてロゴ画像、出力として 512 次元のベクトルが得られます。 2 つのベクトル間の距離が小さいほど、対応する 2 つのロゴは類似しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Robotoff の <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> 関数は、モデルをロゴに適用し、埋め込みを Robotoff postgresql データベースに保存する役割を担っています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>CLIP を使用してロゴ埋め込みを生成する方法を理解するためのより明確なコードは、こちら <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">にあります</a> 。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3️⃣ </em>最も近い近傍を見つける:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ロゴに最も近いものを見つけるために、埋め込みを保存する「インデックス」を使用します。 このインデックスが構築されると、クエリのロゴとデータベースの他のすべてのロゴ間の距離を計算し、最も近いものを返す <strong>「ブルートフォース」💪 メソッドを使用できます</strong>。 これは、「真の」最近傍点を与える最も正確な方法です。 しかし、この方法は適用するには遅すぎます。 ロゴの総数が 250 万の場合、各ロゴの最近傍を抽出するのに必要な時間は約 3 秒です 😴</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>よりよい検索時間が必要であり、精度が低くても問題がなかったため、 <strong>近似法</strong>を使用することにしました。 Robotoff が使用しているのは、HNSW (階層的にナビゲート可能なスモールワールド) と呼ばれます。 最近傍検索をより深く理解するには、 <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">この記事</a> をご覧ください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>HNSW ElasticSearch インデックスを使用することで、Robotoff は 250 万を超えるベクトルの中から各埋め込みの最近傍を非常に高い精度 (返される 100 の最近傍の 90% 以上が、正確に 100 の真の最近傍に含まれる) と 100 ミリ秒未満の短い検索時間で検索できるようになりました 👏👏👏👏。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ロゴに最も近いものを取得するには、次の API を使用できます: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>🍯 貢献のひとさじ: </strong>どこで使われますか?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Robotoff では自動ロゴ分類はまだ実装されていません。 前に説明したことはすべて、 <a href="https://hunger.openfoodfacts.org/">ハンガー ゲーム</a>のためだけに作られています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>それは何ですか ？ これは、Alexandre Fauquette という貢献者によって開発された <strong>注釈プラットフォーム </strong>であり、 <strong>Robotoff によるチェック予測に誰もが回答し、ロゴを分類</strong>することができます。&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>ぜひお試し下さい。 簡単な紹介/チュートリアルで、ロゴに注釈を付けることができるようになります。 😉<br>「ハンガーゲームの使い方」のビデオチュートリアルがまもなく公開される予定です… ⏳</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">ハンガーゲームをプレイするには：hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>ロゴに注釈を付けると、製品とその品質に関するデータの量が増え、Open Food Facts が強化されます。 </strong> また、バックグラウンドで使用されるモデルとアルゴリズムのおかげで、はるかに強力になり、人々の毎日の栄養に大きな影響を与えることができます🥰。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ガブリエルによる記事</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
