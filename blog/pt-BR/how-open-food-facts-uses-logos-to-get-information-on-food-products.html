Como o Open Food Facts usa logotipos para obter informa√ß√µes sobre produtos aliment√≠cios

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üßÇUma pitada de contexto:</strong> ‚Äúlogos‚Äù ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>O Open Food Facts cont√©m cerca de <strong>3 milh√µes de produtos</strong>. Cada produto tem uma embalagem feita para atrair o maior n√∫mero de pessoas poss√≠vel. Nesse sentido, os produtores destacam as qualidades de seus produtos com<strong> s√≠mbolos chamativos e expl√≠citos</strong>. Esses s√≠mbolos s√£o numerosos e podem dar informa√ß√µes sobre a marca do produto, sua qualidade, sua composi√ß√£o, como foi feito, em qual caixa descart√°-lo, etc‚Ä¶&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Para homogeneizar todos os s√≠mbolos e ajudar os consumidores a encontrar produtos que se encaixem neles, <strong>v√°rias institui√ß√µes criaram regras r√≠gidas para que os produtores possam marcar seus produtos com s√≠mbolos espec√≠ficos que chamamos ‚Äúlogotipos‚Äù</strong>. Portanto, h√° uma grande oportunidade üî• de obter dados sobre produtos detectando esses logotipos!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Como o Open Food Facts deve detect√°-los? Gra√ßas a uma mistura entre tecnologia e colaboradores, como sempre!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Rapha√´l Bournhonesque, um antigo colaborador do Open Food Facts que agora faz parte da equipe permanente e meu supervisor de est√°gio, desenvolveu no Robotoff* <strong>um sistema para extrair logotipos de imagens, convert√™-los em vetores e encontrar os vizinhos mais pr√≥ximos de cada vetor.</strong> O objetivo de encontrar os vizinhos dos logotipos era <strong>permitir que os colaboradores "anotassem" (categorizassem manualmente) grandes quantidades de logotipos ao mesmo tempo por meio de uma plataforma chamada <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Jogos Vorazes</a> </strong>üòâ.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Entretanto, os modelos e algoritmos usados naquela √©poca n√£o conseguiam fornecer resultados suficientemente eficientes.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Em setembro de 2022, eu, estudante de engenharia, entrei para a equipe em um est√°gio de 6 meses que se dedicaria a logotipos, e trabalhei na refatora√ß√£o de todo esse processo! &nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* O que √© Robotoff?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> √© um servi√ßo desenvolvido por colaboradores para ajudar no processamento de dados do Open Food Facts. Com base nas informa√ß√µes j√° dispon√≠veis no banco de dados, o objetivo √© recuperar o m√°ximo de informa√ß√µes poss√≠vel sobre cada produto e adicion√°-los ao banco de dados. Atualmente, as atualiza√ß√µes feitas pelo Robotoff v√™m da an√°lise de imagens, atrav√©s de Reconhecimento √ìptico de Caracteres ou modelos mais gerais de Vis√£o Computacional. Algumas atualiza√ß√µes s√£o aplicadas automaticamente ao banco de dados, mas outras precisam de valida√ß√£o manual atrav√©s de perguntas ou pelo programa Hunger Games.<br><br><em><strong>Para saber mais sobre Robotoff, d√™ uma olhada <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">aqui</a>!</strong></em>üëÄ</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>ü´ó Um pouco de tecnologia: </strong>Como funciona exatamente o processamento de logotipos?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1Ô∏è‚É£ </em>Extraia logotipos de imagens de produtos:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Os colaboradores do Open Food Facts treinaram um modelo de aprendizado de m√°quina para reconhecer logotipos em imagens. Colocamos uma imagem como entrada do modelo e recebemos v√°rias caixas delimitadoras com pontua√ß√µes e classes correspondentes. As classes nas quais o modelo foi treinado foram ‚Äúmarca‚Äù e ‚Äúr√≥tulo‚Äù.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Voc√™ pode encontrar o c√≥digo onde o modelo √© chamado aqui: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Voc√™ pode tentar usando a seguinte API:&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Com as caixas delimitadoras, voc√™ pode ver quais s√£o os logotipos correspondentes com a API: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> onde as coordenadas est√£o na mesma ordem que as retornadas pelo modelo nas caixas delimitadoras.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Aqui est√° um exemplo do que acontece ao usar essas APIs com a seguinte imagem:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2Ô∏è‚É£ </em>Converter imagens de logotipos em vetores:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Agora que podemos acessar os logotipos, precisamos vetoriz√°-los</strong>. Para isso, usamos um modelo pr√©-treinado do OpenAI chamado <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Embora o modelo tenha sido inicialmente treinado para combinar imagens com texto, usamos apenas a parte de ‚Äúvis√£o computacional‚Äù do modelo para obter as inser√ß√µes (=logotipos incorporados em um espa√ßo vetorial) computados pelo CLIP para cada logotipo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Temos, portanto, uma imagem de logotipo como entrada e um vetor de dimens√£o 512 como sa√≠da. Quanto menor for a dist√¢ncia entre dois vetores, mais semelhantes ser√£o os dois logotipos correspondentes.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A fun√ß√£o <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> no Robotoff √© respons√°vel por aplicar o modelo aos logotipos e salvar as inser√ß√µes no banco de dados postgresql do Robotoff.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Voc√™ pode encontrar um c√≥digo mais expl√≠cito <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">aqui</a> para entender como usamos o CLIP para gerar inser√ß√µes de logotipos.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3Ô∏è‚É£ </em>Encontre os vizinhos mais pr√≥ximos:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Para encontrar os vizinhos mais pr√≥ximos de um logotipo, usamos um ‚Äú√≠ndice‚Äù para armazenar as inser√ß√µes. Uma vez constru√≠do esse √≠ndice, poder√≠amos usar o m√©todo <strong>‚Äúfor√ßa bruta‚Äù üí™ que consiste em calcular a dist√¢ncia entre o logo da consulta e todos os outros logos do banco de dados e retornar os mais pr√≥ximos</strong>. Esse √© o m√©todo mais preciso, pois nos d√° os ‚Äúverdadeiros‚Äù vizinhos mais pr√≥ximos. Entretanto, esse m√©todo √© muito lento para ser aplicado. O tempo necess√°rio para extrair os vizinhos mais pr√≥ximos de cada logotipo quando a quantidade total de logotipos √© 2,5 milh√µes √© de cerca de 3s üò¥</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Como precis√°vamos de um tempo de busca melhor e n√£o nos import√°vamos com menos precis√£o, decidimos usar <strong>um m√©todo aproximado</strong>. O m√©todo utilizado por Robotoff usa √© chamado PMNH (pequeno mundo hier√°rquico naveg√°vel). Voc√™ pode dar uma olhada <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">neste artigo</a> para entender melhor a busca por vizinhos mais pr√≥ximos.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Usando um √≠ndice PMNH ElasticSearch, o Robotoff agora √© capaz de procurar os vizinhos mais pr√≥ximos de cada inser√ß√£o entre mais de 2,5 milh√µes de vetores com uma precis√£o enorme (mais de 90% dos 100 vizinhos mais pr√≥ximos retornados est√£o entre os exatos 100 vizinhos mais pr√≥ximos verdadeiros) e um tempo de busca curto de menos de 100 ms üëèüëèüëèüëè.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Voc√™ pode usar a seguinte API para obter os vizinhos mais pr√≥ximos de um logotipo: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>üçØ Uma colher de contribui√ß√µes: </strong>Onde √© usado?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Nenhuma categoriza√ß√£o autom√°tica de logotipo ainda 
 foi implementada no Robotoff. Tudo o que expliquei antes √© feito apenas para o programa <a href="https://hunger.openfoodfacts.org/">Jogos Vorazes</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>O que √© isso? √â <strong>uma plataforma de anota√ß√£o </strong>desenvolvida por um colaborador chamado Alexandre Fauquette que <strong>permite que todos respondam √†s previs√µes de verifica√ß√£o feitas pelo Robotoff e categorizem logotipos</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>Voc√™ pode tentar. Uma r√°pida introdu√ß√£o/tutorial lhe dar√° as boas-vindas e voc√™ poder√° fazer anota√ß√µes em logotipos! üòâ<br>A video tutorial of ‚ÄúHow to use Hunger Games ?‚Äù should be out soon‚Ä¶ ‚è≥ ‚è≥ ‚è≥ ‚è≥ ‚è≥ ‚è≥</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Para jogar o programa Hunger Games: hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Anotar logotipos aprimora o Open Food Facts √† medida que aumenta a quantidade de dados que temos sobre produtos e sua qualidade.</strong> E gra√ßas aos modelos e algoritmos usados em segundo plano, voc√™ pode ser muito mais poderoso e ter um impacto maior na alimenta√ß√£o di√°ria das pessoas ü•∞.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Artigo de Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
