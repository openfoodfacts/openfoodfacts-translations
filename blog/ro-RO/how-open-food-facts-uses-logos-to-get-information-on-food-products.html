How Open Food Facts uses logos to get information on food products

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ§‚A pinch of context:</strong> â€œlogosâ€ ?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts is filled with about <strong>3 million products</strong>. Each product has a packaging which is made to attract as many people as possible. To this regard, productors highlight the qualities of their products with<strong> flashy and explicit symbols</strong>. These symbols are numerous and can give information on the brand of the product, its quality, its composition, the way it was made, in which bean to discard it, etcâ€¦&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>To homogenize all symbols and help consumers to find products that fit them, <strong>various institutions have created strict rules for producers to be able to mark their products with specific symbols which we call â€œlogosâ€</strong>. There is thus a huge opportunity ğŸ”¥ to get data about products by detecting these logos!</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>How should Open Food Facts detect them ? Thanks to a mix between technology and contributors, as always!</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>RaphaÃ«l Bournhonesque, a former Open Food Facts contributor who is now part of the permanent team and my internship supervisor, had developed in Robotoff* <strong>a system to extract logos from images, convert them into vectors and find the nearest neighbours of each vector.</strong> The goal of finding logosâ€™ neighbours was <strong>to allow contributors to â€œannotateâ€ (to categorise manually) massive amounts of logos at the same time through a platform, named <a rel="noreferrer noopener" href="https://hunger.openfoodfacts.org/" target="_blank">Hunger Games</a> </strong>ğŸ˜‰.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>However, the models and algorithms used back then could not give efficient enough results.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In September 2022, I, an engineering student, joined the team for an internship of 6 months which would be dedicated to logos, and I worked on refactoring this whole process! ğŸ¥³&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td><strong>* What is Robotoff ?</strong><br><a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff" target="_blank">Robotoff</a> is a service developed by contributors to help Open Food Facts data processing. Based on the data already available in the database, the goal is to retrieve as much information as possible on each product and to add them to the db. Currently, the updates made by Robotoff come from images analysis, through Optical Character Recognition or more general Computer Vision models. Some updates are applied automatically to the db but some others need manual validation via questions or Hunger Games.<br><br><em><strong>To know more about Robotoff, take a look <a rel="noreferrer noopener" href="https://github.com/openfoodfacts/robotoff#readme" target="_blank">here</a>!</strong></em> ğŸ‘€</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ«— A drizzle of tech: </strong>How does logos processing work exactly ?</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4><em>1ï¸âƒ£ </em>Extract logos from products images:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Open Food Facts contributors trained a Machine Learning model to recognize logos in images. We put an image as the input of the model and we receive multiple bounding boxes with corresponding scores and classes. The classes on which the model was trained were â€œbrandâ€ and â€œlabelâ€.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>You can find the code where the model is called here: <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L325" target="_blank" rel="noreferrer noopener">Robotoff.import_image.py</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>You can try it by using the following API :&nbsp;<a href="https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/predict?image_url=[image_url]&amp;models=universal-logo-detector</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Cu casetele de delimitare, puteÈ›i vedea care sunt siglele corespunzÄƒtoare cu API: <a href="https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]" target="_blank" rel="noreferrer noopener">https://robotoff.openfoodfacts.net/api/v1/images/crop?image_url=[image_url]&amp;y_min=[y_min]&amp;x_min=[x_min]&amp;y_max=[y_max]&amp;x_max=[x_max]</a> unde coordonatele sunt Ã®n aceeaÈ™i ordine cu cele returnate de model Ã®n casetele de delimitare.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>IatÄƒ un exemplu de ceea ce se Ã®ntÃ¢mplÄƒ atunci cÃ¢nd utilizaÈ›i aceste API-uri cu urmÄƒtoarea imagine:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg" target="_blank" rel="noreferrer noopener">https://images.openfoodfacts.org/images/products/322/982/012/9488/front_fr.194.400.jpg</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":3425,"width":806,"height":252,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.34.51-1024x321.png" alt="" class="wp-image-3425" width="806" height="252"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4><em>2ï¸âƒ£ </em>ConvertiÈ›i imaginile logo-urilor Ã®n Vectori:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Acum cÄƒ putem accesa logo-uri, trebuie sÄƒ le vectorizam</strong>. Pentru asta, folosim un model pre-antrenat de la OpenAI numit <a href="https://huggingface.co/docs/transformers/model_doc/clip" target="_blank" rel="noreferrer noopener">CLIP</a>. Chiar dacÄƒ modelul a fost antrenat iniÈ›ial pentru a potrivi imaginile cu text, folosim doar partea â€vizualÄƒ pe computerâ€ a modelului pentru a obÈ›ine Ã®nglobÄƒrile (=logo-uri Ã®ncorporate Ã®ntr-un spaÈ›iu vectorial) calculate de CLIP pentru fiecare logo.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Avem astfel o imagine de logo ca intrare È™i un vector cu dimensiunea 512 ca ieÈ™ire. Cu cÃ¢t distanÈ›a dintre doi vectori este mai micÄƒ, cu atÃ¢t cele douÄƒ sigle corespunzÄƒtoare sunt mai asemÄƒnÄƒtoare.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>FuncÈ›ia <a href="https://github.com/openfoodfacts/robotoff/blob/b209707cc062310b51f9886c87ee14be91527644/robotoff/workers/tasks/import_image.py#L398" target="_blank" rel="noreferrer noopener">save_logo_embeddings</a> din Robotoff este responsabilÄƒ de aplicarea modelului logo-urilor È™i de salvarea Ã®nglobÄƒrilor Ã®n baza de date Robotoff postgresql.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PuteÈ›i gÄƒsi un cod mai explicit <a href="https://github.com/openfoodfacts/openfoodfacts-ai/blob/develop/logo-ann/generation/02_generate_embeddings.py#L108" target="_blank" rel="noreferrer noopener">aici</a> pentru a Ã®nÈ›elege cum folosim CLIP pentru a genera Ã®ncorporarea siglelor.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4><em>3ï¸âƒ£ </em>GÄƒsiÈ›i cei mai apropiaÈ›i vecini:</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Pentru a gÄƒsi cei mai apropiaÈ›i vecini ai unui logo, folosim un â€indexâ€ pentru a stoca Ã®nglobÄƒrile. OdatÄƒ construit acest index, am putea folosi metoda <strong>â€forÈ›Äƒ brutÄƒâ€ ğŸ’ª care constÄƒ Ã®n calcularea distanÈ›ei dintre logo-ul de interogare È™i toate celelalte sigle ale db È™i returnarea celor mai apropiate</strong>. Aceasta este metoda cea mai precisÄƒ, deoarece ne oferÄƒ â€adevÄƒraÈ›iiâ€ cei mai apropiaÈ›i vecini. Cu toate acestea, aceastÄƒ metodÄƒ este prea lentÄƒ pentru a fi aplicatÄƒ. Timpul necesar pentru extragerea celor mai apropiaÈ›i vecini pentru fiecare logo atunci cÃ¢nd numÄƒrul total de sigle este de 2,5 milioane este de aproximativ 3s ğŸ˜´</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Deoarece aveam nevoie de un timp de cÄƒutare mai bun È™i eram de acord sÄƒ avem mai puÈ›inÄƒ precizie, am decis sÄƒ folosim <strong>o metodÄƒ aproximativÄƒ</strong>. Cea pe care o foloseÈ™te Robotoff se numeÈ™te HNSW (hierarhical navigable small world). PuteÈ›i arunca o privire la <a rel="noreferrer noopener" href="https://www.pinecone.io/learn/vector-indexes/" target="_blank">acest articol</a> pentru a Ã®nÈ›elege mai bine cÄƒutarea vecinilor cei mai apropiaÈ›i.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Folosind un index HNSW ElasticSearch, Robotoff este acum capabil sÄƒ caute cei mai apropiaÈ›i vecini ai fiecÄƒrei Ã®ncorporare printre mai mult de 2,5 milioane de vectori cu o precizie uriaÈ™Äƒ (mai mult de 90% din cei mai apropiaÈ›i 100 de vecini returnaÈ›i sunt printre cei mai apropiaÈ›i 100 de vecini adevÄƒraÈ›i) È™i un timp scurt de cÄƒutare mai mic de 100 ms ğŸ‘ğŸ‘ğŸ‘ğŸ‘.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PuteÈ›i utiliza urmÄƒtorul API pentru a obÈ›ine cei mai apropiaÈ›i vecini ai unui logo: <a href="https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]">https://robotoff.openfoodfacts.org/api/v1/ann/search/[logo_id]?count=[count]</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>ğŸ¯ O lingurÄƒ de contribuÈ›ii: </strong>Unde se foloseÈ™te?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Nicio clasificare automatÄƒ a logo-ului nu este Ã®ncÄƒ implementatÄƒ Ã®n Robotoff. Tot ce am explicat mai Ã®nainte este fÄƒcut doar pentru <a href="https://hunger.openfoodfacts.org/">Hunger Games</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Ce este ? Este <strong>o platformÄƒ de adnotare </strong>dezvoltatÄƒ de un colaborator pe nume Alexandre Fauquette care <strong>permite tuturor sÄƒ rÄƒspundÄƒ la previziunile de verificare fÄƒcute de Robotoff È™i sÄƒ clasifice logo-urile</strong>.&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><br>PoÈ›i sÄƒ Ã®ncerci. O introducere/tutorial rapidÄƒ vÄƒ va Ã®ntÃ¢mpina È™i veÈ›i putea adnota sigle! ğŸ˜‰<br>Un tutorial video cu â€Cum sÄƒ foloseÈ™ti Jocurile Foamei?â€ ar trebui sÄƒ iasÄƒ Ã®n curÃ¢ndâ€¦ â³</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":3433,"width":505,"height":633,"sizeSlug":"full","linkDestination":"custom"} -->
<figure class="wp-block-image aligncenter size-full is-resized"><a href="hunger.openfoodfacts.org"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Screenshot-2023-02-14-at-14.44.23.png" alt="" class="wp-image-3433" width="505" height="633"/></a><figcaption class="wp-element-caption">Pentru a juca Jocurile Foamei: hunger.openfoodfacts.org</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Adnotarea siglelor Ã®mbunÄƒtÄƒÈ›eÈ™te Open Food Facts pe mÄƒsurÄƒ ce creÈ™te cantitatea de date pe care o avem despre produse È™i calitatea acestora.</strong> È˜i datoritÄƒ modelelor È™i algoritmilor folosiÈ›i Ã®n fundal, puteÈ›i fi mult mai puternic È™i puteÈ›i avea un impact mai mare asupra alimentaÈ›iei zilnice a oamenilor ğŸ¥°.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Articol de Gabriel</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"left","id":3418,"width":167,"height":167,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image alignleft size-full is-resized"><img src="https://blog.openfoodfacts.org/wp-content/uploads/2023/02/Gabriel.png" alt="" class="wp-image-3418" width="167" height="167"/></figure>
<!-- /wp:image -->
